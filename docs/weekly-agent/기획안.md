# 주간요약 에이전트 기획안 (두 단계: 로컬 POC → 베타)

## 공통 목표
- 매일 08:00 전후로 데일리 메모를 남기고, “주간 생성” 버튼을 눌러 이번 주 내용을 요약해 금요일 회의용 텍스트를 얻는다.
- 한국어 우선, 중간에 영어가 섞여도 그대로 반영. 결과는 텍스트(복붙용).

---

## 1단계: 초간단 로컬 POC (DB 없이 React만)
- 스택: React(단일 페이지), 브라우저 localStorage로 영구성, OpenAI 호출은 `.env.local`에 키를 직접 넣고 fetch(배포 안 함, 로컬 실행 전제).
- 화면/UX (Toss 느낌의 미니멀, 라운디드, 옅은 색):
  - 상단: “주간 생성” CTA 버튼 + 기간 표시(이번 주 월~금 자동 계산).
  - 입력 카드: 날짜 피커(기본 오늘), 텍스트 영역, “저장”(localStorage에 append).
  - 리스트: 날짜별 카드로 저장된 데일리 보여주기, 삭제/수정 버튼.
  - 결과 패널: “주간 생성” 클릭 시 요약 텍스트 표시 영역 + “재생성”/“복사” 버튼.
- 상태 관리:
  - `entries: {id, date, text}` 배열을 `useState` + `localStorage` sync.
  - “이번 주” 필터: 주간 시작(월)~끝(금) 계산 → filter 후 LLM 호출 payload로 사용.
  - 요약 응답 캐시: 마지막 요약 결과를 state로 저장해 재렌더 시 유지.
- LLM 호출 예시:
  - 프롬프트: “이번 주 데일리 메모를 완료/진행/블로커/결정/요청 5섹션으로 요약, 각 섹션 3~5줄, 중복 제거, 불확실시 ‘(확인 필요)’.”
  - 입력: 이번 주 메모를 날짜순으로 합쳐 전달.
- 장단점:
  - 장점: 1시간 내 바로 시험 가능, 인프라 불필요.
  - 단점: 브라우저 로컬 데이터라 다른 기기/브라우저로는 접근 불가, 키 노출 위험(로컬 전제).

---

## 2단계: 베타 (Supabase + Vercel, 수동 트리거)
- 스택: React(Vite/Next.js SPA 모드) + Supabase Auth/DB + Edge Function(요약) + Vercel 호스팅. GitHub Actions/cron 없음, UI 버튼으로 요약 수동 실행.
- 인증/도메인 제한:
  - Supabase Email/Password Auth 사용, 회원가입 시 이메일 도메인 `@fnguide.com` 검증(Edge Function 또는 DB 트리거로 가입 거부).
  - 옵션: 이메일 확인(verification) 비활성화 가능하나 내부만 쓰더라도 확인 메일 활성화 권장.
- 데이터 스키마 (Postgres/Supabase)
  - `profiles` (id UUID PK, email text unique, name text, created_at)
  - `daily_logs` (id UUID PK, user_id UUID FK → profiles.id, log_date date, text text, tags jsonb, created_at timestamptz)
  - `weekly_reports` (id UUID PK, user_id UUID FK, week_start date, week_end date, summary text, source_logs jsonb, created_at timestamptz)
  - 인덱스: `daily_logs` on (user_id, log_date), `weekly_reports` on (user_id, week_start)
  - RLS: 각 테이블은 `auth.uid() = user_id` 조건으로 SELECT/INSERT/UPDATE 허용. `@fnguide.com` 체크는 가입 시 서버 측에서 강제.
- 요약 트리거(수동 버튼):
  - React에서 “주간 생성” 클릭 → Supabase Edge Function 호출 → 최근 한 주(월~금) `daily_logs` fetch → 전처리 후 OpenAI 호출 → `weekly_reports`에 저장 → 응답으로 summary 반환.
  - 재생성: 같은 주차에 대해 덮어쓰기 or 새 버전 저장(필드 추가: `version int`, `parent_report_id` 옵션).
- React UX (베타):
  - 상단: “주간 생성” 버튼 + 주차 범위 표기, 마지막 생성 시간 표시.
  - 입력 영역: 날짜 기본 오늘, 텍스트, “저장” 버튼. 내역 리스트(수정/삭제).
  - 결과 영역: 최신 주간요약 표시, “재생성/복사”.
  - 로그인/회원가입 폼: 이메일/비밀번호, `@fnguide.com` 아닐 시 에러 토스트.
  - 테마: 로고 없는 미니멀 카드 레이아웃, 연한 회색 배경, 흰색 카드, 라운딩+섀도우 소량, 파스텔 블루/민트 포인트.
- BE 설계 (Supabase 활용)
  - Auth: Supabase Auth(E-mail/Password). 가입 훅: `signup` 요청 시 이메일 도메인 검사하는 Edge Function 또는 SQL 정책으로 `email like '%@fnguide.com'` 아닌 경우 reject.
  - Data API: 클라이언트에서 Supabase JS로 직접 RLS 보호 테이블에 CRUD(추가 서버 구축 불필요).
  - 요약 API: Supabase Edge Function(Typescript) or Vercel Serverless Function.
    - 입력: user_id, week_start/week_end (클라이언트에서 ISO 날짜 전달).
    - 처리: 쿼리 → 전처리(불릿 분할, 중복 제거) → OpenAI → DB 저장 → summary 반환.
  - 비밀키: Edge Function/Vercel 환경변수에 OpenAI 키 저장. 브라우저에는 노출 금지.
- 프롬프트(베타)
  ```
  역할: 이번 주 데일리 노트를 요약하는 비서.
  입력: {YYYY-MM-DD: 텍스트...} 형식으로 날짜별 메모.
  규칙: 완료/진행/블로커/결정/요청 5섹션, 섹션당 3~5줄, 중복 제거, 사람/업무명 유지, 불확실시 “(확인 필요)” 표시.
  출력: 순수 텍스트, TL;DR 3줄 → 섹션 순서.
  ```

---

## React 동작 흐름 정리 (공통)
- 상태: `entries`, `selectedWeek`, `summary`, `loading` (+ 베타에서는 auth 상태, 사용자 정보 포함).
- 액션:
  - `saveEntry(entry)`: POC→localStorage / 베타→Supabase `daily_logs` insert.
  - `fetchWeekEntries(week)`: POC→local filter / 베타→Supabase query.
  - `generateWeeklySummary(week)`: POC→프론트에서 OpenAI fetch / 베타→Edge Function 호출.
  - `delete/updateEntry`: POC→localStorage / 베타→Supabase update/delete.
- UI 반응:
  - 저장 성공 시 토스트, 리스트 즉시 업데이트.
  - 요약 중 로딩 스피너, 실패 시 재시도 버튼.
  - 요약 결과 복사 버튼으로 클립보드 복사.

---

## 작업 우선순위
1) 로컬 POC: React 단일 페이지 작성 → localStorage CRUD → 주간 필터+요약 버튼 → OpenAI 호출 프롬프트 적용 → 기본 톤앤매너 스타일링.
2) 베타 준비: Supabase 프로젝트 생성 → 스키마/정책 적용 → Edge Function(요약) 작성 → React를 Supabase Auth/DB에 연결 → Vercel 배포.
